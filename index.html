<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Octo Dash: The Rescue Mission</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Comic Sans MS', cursive, sans-serif;
            background: #001f3f;
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .screen { display: none; width: 100%; height: 100vh; position: absolute; top: 0; left: 0; }
        .screen.active { display: flex; }
        #landingScreen { flex-direction: column; justify-content: center; align-items: center; background-image: url('images/landing-bg.jpg'); background-size: cover; background-position: center; color: white; text-align: center; padding: 2rem; position: relative; }
        .landing-content { position: relative; z-index: 1; }
        .title { font-size: 3.5rem; margin-bottom: 1rem; text-shadow: 3px 3px 6px rgba(0,0,0,0.8); animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100%{transform:translateY(0);}50%{transform:translateY(-10px);} }
        .subtitle { font-size: 1.5rem; margin-bottom: 2rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
        .input-container { margin: 2rem 0; }
        .input-container input { padding:1rem 2rem; font-size:1.2rem; border:3px solid #8b4bc6; border-radius:50px; width:300px; text-align:center; background: rgba(255,255,255,0.95); }
        .btn { margin-top:2rem; padding:1rem 3rem; font-size:1.5rem; background: linear-gradient(135deg,#8b4bc6 0%,#6a2c9e 100%); color:white; border:none; border-radius:50px; cursor:pointer; box-shadow:0 8px 20px rgba(139,75,198,0.4); transition: all 0.3s ease; font-weight:bold; }
        .btn:hover { transform: translateY(-3px); box-shadow:0 12px 30px rgba(139,75,198,0.6); }
        .profile-preview { margin-top:1rem; padding:1rem; background: rgba(139,75,198,0.3); border-radius:15px; display:none; backdrop-filter:blur(10px); opacity:0; transition:opacity 0.6s ease; }
        .profile-preview.show { display:block; opacity:1; }
        .made-with-love { margin-top:2rem; font-size:1.1rem; text-shadow:2px 2px 4px rgba(0,0,0,0.8); }
        .made-with-love a { color:#ff6b9d; text-decoration:none; font-weight:bold; transition:color 0.3s; }
        .made-with-love a:hover { color:#ff8fb3; }
        #comicScreen { justify-content:center; align-items:center; background:#000; }
        .comic-container { width:90%; max-width:900px; height:90vh; display:flex; flex-direction:column; justify-content:center; align-items:center; position:relative; }
        .comic-image { max-width:100%; max-height:80%; border:5px solid #333; border-radius:15px; box-shadow:0 10px 40px rgba(0,0,0,0.8); opacity:0; transition:opacity 0.6s ease-in-out; }
        .comic-image.show { opacity:1; }
        .comic-controls { position:absolute; bottom:10px; display:flex; gap:1rem; }
        .comic-skip { padding:0.8rem 2rem; font-size:1.1rem; background: rgba(139,75,198,0.8); color:white; border:none; border-radius:25px; cursor:pointer; transition: all 0.3s ease; }
        .comic-skip:hover { background: rgba(139,75,198,1); transform: scale(1.05); }
        #gameScreen { justify-content:center; align-items:center; position:relative; background:#001f3f; }
        #gameCanvas { border:5px solid #8b4bc6; border-radius:15px; box-shadow:0 10px 40px rgba(0,0,0,0.5); }
        .score-display { position:absolute; top:20px; right:20px; background:rgba(139,75,198,0.9); color:white; padding:1rem 2rem; border-radius:15px; font-size:2rem; font-weight:bold; box-shadow:0 5px 15px rgba(0,0,0,0.3); pointer-events:none; }
        #gameOverScreen { flex-direction:column; justify-content:center; align-items:center; background-image:url('images/ocean-bg.jpg'); background-size:cover; background-position:center; color:white; text-align:center; position:relative; }
        #gameOverScreen::before { content:''; position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); z-index:0; }
        #gameOverScreen > * { position:relative; z-index:1; }
        .game-over-title { font-size:4rem; margin-bottom:2rem; color:#ff6b6b; text-shadow:3px 3px 6px rgba(0,0,0,0.5); }
        .final-score { font-size:3rem; margin-bottom:2rem; color:#ffd93d; text-shadow:2px 2px 4px rgba(0,0,0,0.5); }
        @media (max-width:768px) {
            .title { font-size:2rem; }
            .subtitle { font-size:1rem; }
            #gameCanvas { width:90vw !important; height:60vh !important; }
            .input-container input { width:250px; }
            .game-over-title { font-size:2.5rem; }
            .final-score { font-size:2rem; }
        }
    </style>
</head>
<body>

<div class="screen active" id="landingScreen">
    <div class="landing-content">
        <h1 class="title">üêô Octo Dash üêô</h1>
        <p class="subtitle">The Rescue Mission</p>
        <div class="input-container">
            <input type="text" id="twitterHandle" placeholder="Enter your Twitter @username" maxlength="15">
        </div>
        <div class="profile-preview" id="profilePreview">
            <p>Welcome, <span id="displayName">@username</span>!</p>
        </div>
        <button class="btn" onclick="startComic()">Start Game</button>
        <p class="made-with-love">Made with ‚ù§Ô∏è by <a href="https://x.com/web3gurru" target="_blank">@web3gurru</a></p>
        <p style="margin-top:0.5rem; opacity:0.8; font-size:0.9rem; text-shadow:2px 2px 4px rgba(0,0,0,0.8);">for Re Protocol Community</p>
    </div>
</div>

<div class="screen" id="comicScreen">
    <div class="comic-container">
        <img id="comicImage" src="" alt="Comic Page" class="comic-image">
        <div class="comic-controls">
            <button class="comic-skip" onclick="skipComic()">Skip Story ‚Üí</button>
        </div>
    </div>
</div>

<div class="screen" id="gameScreen">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="score-display">Score: <span id="scoreValue">0</span></div>
</div>

<div class="screen" id="gameOverScreen">
    <h1 class="game-over-title">GAME OVER!</h1>
    <p class="final-score">Final Score: <span id="finalScore">0</span></p>
    <p style="font-size:2rem; margin-bottom:2rem; opacity:0.8;">The baby octopuses still need you!</p>
    <button class="btn" onclick="restartGame()">Try Again</button>
    <button class="btn" onclick="shareScore()" style="margin-top:1rem; background: linear-gradient(135deg, #1DA1F2 0%, #0d8ddb 100%);">
        üêô Share on X
    </button>
    <button class="btn" onclick="backToMenu()" style="margin-top:1rem;">Back To Main Page</button>
</div>

<script>
    function showScreen(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        const screen = document.getElementById(screenId);
        if (screen) screen.classList.add('active');
    }

    const twitterInput = document.getElementById('twitterHandle');
    const displayName = document.getElementById('displayName');
    const profilePreview = document.getElementById('profilePreview');
    if (twitterInput) {
        twitterInput.addEventListener('input', e => {
            const handle = e.target.value.trim().replace(/@/g,'');
            if(handle){ displayName.textContent = handle; profilePreview.classList.add('show'); }
            else profilePreview.classList.remove('show');
        });
    }

    const comicPages = ['images/comic-page-1.png','images/comic-page-2.png','images/comic-page-3.png'];
    let currentComicPage=0, comicTimeout=null;
    const comicImage=document.getElementById('comicImage');

    function startComic(){
        const username=twitterInput.value.trim();
        if(!username){ alert('Please enter your Twitter username to begin the mission!'); return; }
        currentComicPage=0; showScreen('comicScreen'); loadComicPage(true);
    }

    function loadComicPage(firstLoad=false){
        if(currentComicPage>=comicPages.length){ startGame(); return; }
        const imgSrc=comicPages[currentComicPage];
        const tempImg=new Image(); tempImg.src=imgSrc;
        tempImg.onload=()=>{
            if(!firstLoad){ comicImage.classList.remove('show');
                setTimeout(()=>{ comicImage.src=imgSrc; comicImage.classList.add('show'); },600);
            } else { comicImage.src=imgSrc; comicImage.classList.add('show'); }
            comicTimeout=setTimeout(()=>{ currentComicPage++; loadComicPage(false); },5000);
        };
        tempImg.onerror=()=>{ currentComicPage++; loadComicPage(false); };
    }

    function skipComic(){ if(comicTimeout) clearTimeout(comicTimeout); startGame(); }

    const canvas=document.getElementById('gameCanvas'); const ctx=canvas.getContext('2d');
    let gameRunning=false, score=0, octopusX=canvas.width/2-50, octopusY=canvas.height-140, octopusSpeed=10, babies=[], babySpeed=2, gameLoopId;
    const octopusImg=new Image(); octopusImg.src='images/octopus-main.png';
    const babyImg=new Image(); babyImg.src='images/octopus-baby.png';
    window.bgImg=new Image(); window.bgImg.src='images/ocean-bg.jpg'; window.bgImg.onload=()=>{window.bgImgLoaded=true;}
    const keys={};
    document.addEventListener('keydown', e=>keys[e.key]=true);
    document.addEventListener('keyup', e=>keys[e.key]=false);
    let touchStartX=0;
    canvas.addEventListener('touchstart', e=>touchStartX=e.touches[0].clientX);
    canvas.addEventListener('touchmove', e=>{
        const touchX=e.touches[0].clientX; const diff=touchX-touchStartX;
        if(Math.abs(diff)>10){ keys['ArrowRight']=diff>0; keys['ArrowLeft']=diff<0; } touchStartX=touchX;
    });
    canvas.addEventListener('touchend', ()=>{ keys['ArrowLeft']=false; keys['ArrowRight']=false; });

    function spawnBaby(){ babies.push({x:Math.random()*(canvas.width-50),y:-50,caught:false}); }
    function startGame(){
        showScreen('gameScreen'); gameRunning=true; score=0; babies=[]; babySpeed=2; octopusX=canvas.width/2-50;
        document.getElementById('scoreValue').textContent=score;
        const spawnInterval=setInterval(()=>{ if(gameRunning) spawnBaby(); else clearInterval(spawnInterval); },1500);
        gameLoop();
    }

    function gameLoop(){
        if(!gameRunning) return;
        if(window.bgImgLoaded) ctx.drawImage(window.bgImg,0,0,canvas.width,canvas.height);
        else { const gradient=ctx.createLinearGradient(0,0,0,canvas.height); gradient.addColorStop(0,'#001f3f'); gradient.addColorStop(1,'#003d5c'); ctx.fillStyle=gradient; ctx.fillRect(0,0,canvas.width,canvas.height); }
        if(keys['ArrowLeft'] && octopusX>0) octopusX-=octopusSpeed;
        if(keys['ArrowRight'] && octopusX<canvas.width-100) octopusX+=octopusSpeed;
        ctx.drawImage(octopusImg,octopusX,octopusY,150,150);
        for(let i=babies.length-1;i>=0;i--){
            const baby=babies[i]; baby.y+=babySpeed;
            if(!baby.caught && baby.x+25>octopusX && baby.x<octopusX+100 && baby.y+25>octopusY && baby.y<octopusY+70){
                baby.caught=true; score++; document.getElementById('scoreValue').textContent=score; babies.splice(i,1);
                if(score%5===0 && babySpeed<8) babySpeed+=0.5;
            } else if(baby.y>canvas.height+50){ if(!baby.caught){ gameOver(); return; } babies.splice(i,1); }
            else { ctx.shadowBlur=15; ctx.shadowColor='#e0b3ff'; ctx.drawImage(babyImg,baby.x,baby.y,65,65); ctx.shadowBlur=0; }
        }
        gameLoopId=requestAnimationFrame(gameLoop);
    }

    function gameOver(){
        gameRunning=false; cancelAnimationFrame(gameLoopId);
        document.getElementById('finalScore').textContent=score;
        showScreen('gameOverScreen');
    }

    function restartGame(){ startGame(); }
    function backToMenu(){ showScreen('landingScreen'); }

    function shareScore(){
        const score=document.getElementById('finalScore').textContent;
        const tweet=encodeURIComponent(`I just saved ${score} baby octopuses in üêô Octo Dash! Can you beat my score? #OctoDashGame`);
        window.open(`https://twitter.com/intent/tweet?text=${tweet}`,'_blank');
    }
</script>
</body>
</html>
